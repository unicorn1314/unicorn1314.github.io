<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åæ ‡å·¥å…·~</title>
  <link rel="stylesheet" href="./ol/ol.css">
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.all.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #f5f6fa;
      display: flex;
      height: 100vh;
    }
    #map {
      width: 100%;
      height: 400px;
      border: 2px solid pink;
      margin-top: 10px;
      border-radius: 10px;
    }
    .sidebar {
      width: 200px;
      background-color: #fff;
      border-right: 1px solid #e8ecef;
      padding: 20px 0;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
    }
    .nav-item {
      padding: 15px 20px;
      color: #606c88;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .nav-item:hover {
      background-color: #e8ecef;
      color: #3b5998;
    }
    .nav-item.active {
      background-color: #e3f2fd;
      color: #3b5998;
      font-weight: bold;
    }
    .content-area {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    .content {
      display: none;
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .content.active {
      display: block;
    }
    h2 {
      color: #3b5998;
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .crs-group {
      display: flex;
      gap: 20px; /* å·¦å³é—´è· */
    }
    .crs-group .form-group {
      flex: 1; /* å·¦å³å‡åˆ† */
    }
    label {
      display: block;
      margin-bottom: 5px;
      color: #606c88;
    }
    input, select {
      width: 100%;
      padding: 8px;
      border: 1px solid #e8ecef;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      padding: 10px 20px;
      background-color: #3b5998;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #4a69bd;
    }
    #result{
     border: 2px solid #3b5998;
     padding: 10px;
     border-radius: 10px;
    }
    
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="nav-item active" onclick="switchTab(0)">ğŸ” åæ ‡æŸ¥è¯¢</div>
    <div class="nav-item" onclick="switchTab(1)">ğŸ“ åæ ‡è½¬æ¢</div>
    <div class="nav-item" onclick="switchTab(2)">ğŸ—ºï¸ æŠ•å½±è½¬æ¢</div>
    <div class="nav-item" onclick="switchTab(3)">âš™ï¸ å‚æ•°è°ƒæ•´</div>
    <div class="nav-item" onclick="switchTab(4)">ğŸ“œ æ‰¹é‡è½¬æ¢</div>
    
  </div>
  <div class="content-area">
   
    <!-- åæ ‡æŸ¥è¯¢ -->
    <div class="content active">
      <h2>åæ ‡æŸ¥è¯¢</h2>
      <div>
        <label>ç»åº¦ï¼š</label><input id="lon" type="number" step="0.000001">
        <label>çº¬åº¦ï¼š</label><input id="lat" type="number" step="0.000001">
        <button onclick="Export()">å¯¼å…¥é€‰å®šåæ ‡ ğŸ§­</button>
      </div> 
      <div id="map"></div>


    </div>
     <!-- åæ ‡è½¬æ¢ -->
     <div class="content ">
      <h2>åæ ‡è½¬æ¢</h2>
      <div class="crs-group">
        <div class="form-group">
          <label>åŸåæ ‡ç³»</label>
          <select id="sourceCRS">
            <option value="EPSG:4326">WGS84 (GPS)</option>
            <option value="EPSG:4326">CGCS2000</option>
            <option value="EPSG:4610">è¥¿å®‰80</option>
            <option value="EPSG:4214">åŒ—äº¬54</option>
          </select>
        </div>
        <div class="form-group">
          <label>ç›®æ ‡åæ ‡ç³»</label>
          <select id="targetCRS">
            <option value="EPSG:4326">WGS84 (GPS)</option>
            <option value="EPSG:4326">CGCS2000</option>
            <option value="EPSG:4610">è¥¿å®‰80</option>
            <option value="EPSG:4214">åŒ—äº¬54</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>ç»åº¦ (Â°)</label>
        <input type="text" id="longitude" placeholder="114.000000" value="115.619867">
      </div>
      <div class="form-group">
        <label>çº¬åº¦ (Â°)</label>
        <input type="text" id="latitude" placeholder="34.000000" value="39.633801">
      </div>
      <button onclick="convertCoordinates()">è½¬æ¢</button>
      <div id="result" style="margin-top: 15px; color: #606c88;"></div>
      
    </div>
        <!-- æŠ•å½±è½¬æ¢ -->
        <div class="content">
          <h2>æŠ•å½±åæ ‡è½¬æ¢</h2>
          <div class="form-group">
            <label>é€‰æ‹©æŠ•å½±ç±»å‹</label>
            <select id="projectionType" onchange="toggleBandInput()">
              <option value="wgs84">WGS84 (ç»çº¬åº¦)</option>
              <option value="webMercator">Web Mercator (EPSG:3857)</option>
              <option value="gaussKruger">é«˜æ–¯æŠ•å½± (Gauss-KrÃ¼ger)</option>
            </select>
          </div>
          <div id="bandInput" class="form-group" style="display: none;">
            <label>å¸¦å· (3Â°å¸¦ï¼Œå¦‚ 33-53)</label>
            <input type="number" id="bandNumber" min="33" max="53" placeholder="è¾“å…¥å¸¦å·" value="39">
          </div>
          <div class="form-group">
            <label>è¾“å…¥åæ ‡</label>
            <div style="display: flex; gap: 20px;">
              <input type="text" id="inputX" placeholder="X æˆ– ç»åº¦ (Â°)" value="115.619867" style="flex: 1;">
              <input type="text" id="inputY" placeholder="Y æˆ– çº¬åº¦ (Â°)" value="39.633801" style="flex: 1;">
            </div>
          </div>
          <button onclick="toProjection()">è½¬ä¸ºæŠ•å½±åæ ‡</button>
          <div id="projResult" style="margin: 15px 0; color: #606c88;"></div>
          <div class="form-group">
            <label>è¾“å…¥æŠ•å½±åæ ‡</label>
            <div style="display: flex; gap: 20px;">
              <input type="text" id="projX" placeholder="Xï¼ˆç±³ï¼‰" style="flex: 1;">
              <input type="text" id="projY" placeholder="Yï¼ˆç±³ï¼‰" style="flex: 1;">
            </div>
          </div>
          <button onclick="toWgs84()">è½¬ä¸ºç»çº¬åº¦</button>
          <div id="wgs84Result" style="margin-top: 15px; color: #606c88;"></div>
        </div>
    <!-- å‚æ•°è°ƒæ•´ -->
    <div class="content">
      <h2>å‚æ•°è°ƒæ•´</h2>
      <div class="form-group">
        <label>åæ ‡ç³»</label>
        <select id="revise">
          <option value="EPSG:4610">è¥¿å®‰80</option>
          <option value="EPSG:4214">åŒ—äº¬54</option>
        </select>
      </div>
      <div class="form-group">
        <label>towgs84 å‚æ•°</label>
        <input id="seven" type="text" placeholder="dx,dy,dz,rx,ry,rz,ds" value="-50,-50,-50,0,0,0,0">
      </div>
      <button onclick="setpro()">âš™ï¸ åº”ç”¨å‚æ•°</button>
    </div>

    <!-- æ‰¹é‡è½¬æ¢ -->
    <div class="content">
      <h2>æ‰¹é‡åœ°ç†åæ ‡è½¬æ¢</h2>
      <div class="crs-group">
        <div class="form-group">
          <label>åŸåæ ‡ç³»</label>
          <select id="sourceCRSS">
            <option value="EPSG:4326">WGS84 (GPS)</option>
            <option value="EPSG:4610">è¥¿å®‰80</option>
            <option value="EPSG:4214">åŒ—äº¬54</option>
            <option value="EPSG:4490">CGCS2000</option>
          </select>
        </div>
        <div class="form-group">
          <label>ç›®æ ‡åæ ‡ç³»</label>
          <select id="targetCRSS">
            <option value="EPSG:4326">WGS84 (GPS)</option>
            <option value="EPSG:4610">è¥¿å®‰80</option>
            <option value="EPSG:4214">åŒ—äº¬54</option>
            <option value="EPSG:4490">CGCS2000</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>ä¸Šä¼  CSV æ–‡ä»¶ï¼ˆæ ¼å¼ï¼šç»åº¦,çº¬åº¦ï¼‰</label>
        <input type="file" id="csvInput" accept=".txt">
      </div>
      <button onclick="convertBatch()"  id="convertBtn">ğŸ¾ æ‰¹é‡è½¬æ¢</button>
      <div id="tableContainer" style="margin: 20px 0; max-height: 300px; overflow-y: auto;">
        <table id="coordsTable" style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="background-color: #e3f2fd; color: #3b5998;">
              <th style="padding: 10px; border: 1px solid #e8ecef;">åŸå§‹ç»åº¦ (Â°)</th>
              <th style="padding: 10px; border: 1px solid #e8ecef;">åŸå§‹çº¬åº¦ (Â°)</th>
              <th style="padding: 10px; border: 1px solid #e8ecef;">è½¬æ¢åç»åº¦ (Â°)</th>
              <th style="padding: 10px; border: 1px solid #e8ecef;">è½¬æ¢åçº¬åº¦ (Â°)</th>
              <th style="padding: 10px; border: 1px solid #e8ecef;">è¯¯å·® (ç±³)</th>
            </tr>
          </thead>
          <tbody id="coordsTableBody"></tbody>
        </table>
      </div>
      <button onclick="exportCSV()"  id="exportBtn">ğŸ“¤ å¯¼å‡º CSV</button>
    </div>
  </div>
   
 
  <script src="./ol/ol.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.9.0/proj4.js"></script>
  <script>
  // æ³¨å†Œ proj4 åˆ° ol.proj
   ol.proj.proj4.register(proj4);

   // å®šä¹‰ CGCS2000 åæ ‡ç³»
   proj4.defs("EPSG:4490", "+proj=longlat +ellps=GRS80 +no_defs");

    // æ·»åŠ é¢å¤–åæ ‡ç³»å®šä¹‰
    proj4.defs("EPSG:4490", "+proj=longlat +ellps=GRS80 +no_defs"); // CGCS2000

    // å®šä¹‰åŒ—äº¬54ï¼ˆEPSG:4214ï¼‰å’Œè¥¿å®‰80ï¼ˆEPSG:4610ï¼‰çš„æŠ•å½±
    proj4.defs('EPSG:4214', '+proj=longlat +ellps=krass +towgs84=15.8,-154.4,-82.3,0,0,0,0 +no_defs');

   // è¥¿å®‰80 (EPSG:4610) åˆ° WGS84 (EPSG:4326) çš„åŒ—äº¬åœ°åŒºä¸ƒå‚æ•°
    proj4.defs('EPSG:4610', '+proj=longlat +ellps=IAG75 +towgs84=-30, -30, -40, 0, 0, 0, 0 +no_defs');

 // åœ°å›¾åˆå§‹åŒ– å®šä½åŒ—äº¬
 const map = new ol.Map({
      target: 'map',
      layers: [new ol.layer.Tile({ source: new ol.source.OSM() })],
      view: new ol.View({
        center: ol.proj.fromLonLat([116.38, 39.90]),
        zoom: 18
      })
    });

      // ç‚¹å›¾å±‚
        // åˆ›å»ºçŸ¢é‡å›¾å±‚å­˜æ”¾æ ‡è®°ç‚¹
    const markerSource = new ol.source.Vector();
        const markerLayer = new ol.layer.Vector({
      source: markerSource,
      style: new ol.style.Style({
        image: new ol.style.Circle({
          radius: 9, // åœ†åœˆå¤§å° 
          fill: new ol.style.Fill({ color: 'red' }), // å¡«å……è‰²
          stroke: new ol.style.Stroke({ color: 'white', width: 2 }) // è¾¹æ¡†
        })
      })
    });
    map.addLayer(markerLayer);

    function showPoint(coord3857) {
  markerLayer.getSource().clear();
  const point = new ol.geom.Point(coord3857);
  const feature = new ol.Feature(point);
  markerLayer.getSource().addFeature(feature);
  map.getView().animate({ center: coord3857 }); // ğŸš« ä¸è¦ zoomï¼
}

    // ç›‘å¬ç‚¹å‡»åœ°å›¾ï¼Œæ˜¾ç¤ºåæ ‡
    map.on('click', function (evt) {
      const coord3857 = evt.coordinate;
      const [lon, lat] = ol.proj.toLonLat(coord3857);
      document.getElementById("lon").value = lon.toFixed(6);
      document.getElementById("lat").value = lat.toFixed(6);
      updateAllCoords();
    });
        // æ ¸å¿ƒè½¬æ¢å‡½æ•° 
    function updateAllCoords() {
      const lon = parseFloat(document.getElementById("lon").value);
      const lat = parseFloat(document.getElementById("lat").value);
       // ğŸ¾ åŸå§‹ WGS84
      const wgs84 = [lon, lat];
      const mercator = ol.proj.fromLonLat(wgs84);
      showPoint(mercator); // é»˜è®¤åœ°å›¾ä¸Šå±•ç¤ºå¢¨å¡æ‰˜ä½ç½®
    }

    function convertCoordinates() {
      const sourceCRS = document.getElementById('sourceCRS').value;
      const targetCRS = document.getElementById('targetCRS').value;
      const lon = parseFloat(document.getElementById('longitude').value);
      const lat = parseFloat(document.getElementById('latitude').value);
      const resultDiv = document.getElementById('result');

      if (isNaN(lon) || isNaN(lat)) {
        resultDiv.innerHTML = '<span style="color: red;">ç»çº¬åº¦è¾“å…¥æœ‰è¯¯å“¦ï¼</span>';
        return;
      }

      const coords = [lon, lat];
      const converted = proj4(sourceCRS, targetCRS, coords);
      const error = ol.sphere.getDistance(coords, converted);
      // è®¡ç®—ç»çº¬åº¦å·®ï¼ˆå¦‚æœéœ€è¦æ˜¾ç¤ºï¼‰
    const diffLon = Math.abs(coords[0] - converted[0]);
    const diffLat = Math.abs(coords[1] - converted[1]);

      resultDiv.innerHTML = `
       <div class="result">
        <h2>è½¬æ¢ç»“æœ</h2>
        <strong>åæ ‡ä»£ç :${targetCRS}<br><br>ç»åº¦:${converted[0].toFixed(6)}Â°<br><br>çº¬åº¦:${converted[1].toFixed(6)}Â°
        </strong><br>
        <h2>è¯¯å·®åˆ†æ</h2>
        <strong>ğŸ“ç»çº¬åº¦å·®å¼‚ï¼š<br>ç»åº¦å·®: Î”Lon=${diffLon.toFixed(6)}Â°<br> çº¬åº¦å·®:Î”Lat=${diffLat.toFixed(6)}Â°<br><br><br></strong>
        <strong>ğŸ¯è¯¯å·®ï¼ˆä¼°ç®—è·ç¦»ï¼‰:${error.toFixed(6)}</strong>  ç±³<br>
      </div>
      `;
      
      Swal.fire(
  'æˆåŠŸ!',
  'è½¬æ¢å·²å®Œæˆã€‚',
  'success'
);
    }

    // é«˜æ–¯æŠ•å½±å®šä¹‰ï¼ˆåŠ¨æ€ç”Ÿæˆå¸¦å·ï¼‰
  function getGaussKrugerDef(band) {
    const centralMeridian = (band - 1) * 3 - 180 + 1.5; // 3åº¦å¸¦ä¸­å¿ƒç»çº¿
    return `+proj=tmerc +lat_0=0 +lon_0=${centralMeridian} +k=1 +x_0=500000 +y_0=0 +ellps=krass +units=m +no_defs`;
  }

  function toggleBandInput() {
    const projectionType = document.getElementById('projectionType').value;
    const bandInput = document.getElementById('bandInput');
    bandInput.style.display = projectionType === 'gaussKruger' ? 'block' : 'none';
  }

  function toProjection() {
    const projectionType = document.getElementById('projectionType').value;
    const inputX = parseFloat(document.getElementById('inputX').value);
    const inputY = parseFloat(document.getElementById('inputY').value);
    const band = document.getElementById('bandNumber').value;
    const resultDiv = document.getElementById('projResult');

    if (isNaN(inputX) || isNaN(inputY)) {
      resultDiv.innerHTML = '<span style="color: red;">è¾“å…¥åæ ‡æœ‰è¯¯å“¦ï¼</span>';
      return;
    }

    let coords = [inputX, inputY];
    let targetProj;

    if (projectionType === 'wgs84') {
      resultDiv.innerHTML = '<span style="color: orange;">å·²ä¸º WGS84ï¼Œæ— éœ€è½¬æ¢ï¼</span>';
      return;
    } else if (projectionType === 'webMercator') {
      targetProj = 'EPSG:3857';
      coords = ol.proj.fromLonLat(coords); // WGS84 è½¬ Web Mercator
    } else if (projectionType === 'gaussKruger' && band) {
      targetProj = getGaussKrugerDef(parseInt(band));
      coords = proj4('EPSG:4326', targetProj, coords); // WGS84 è½¬é«˜æ–¯
    } else {
      resultDiv.innerHTML = '<span style="color: red;">è¯·é€‰æ‹©å¸¦å·ï¼</span>';
      return;
    }

    resultDiv.innerHTML = `
      <strong>æŠ•å½±åæ ‡ï¼š</strong><br>
      X: ${coords[0].toFixed(2)} ç±³, Y: ${coords[1].toFixed(2)} ç±³
    `;
    document.getElementById('projX').value = coords[0].toFixed(2);
    document.getElementById('projY').value = coords[1].toFixed(2);
  }

  function toWgs84() {
    const projectionType = document.getElementById('projectionType').value;
    const projX = parseFloat(document.getElementById('projX').value);
    const projY = parseFloat(document.getElementById('projY').value);
    const band = document.getElementById('bandNumber').value;
    const resultDiv = document.getElementById('wgs84Result');

    if (isNaN(projX) || isNaN(projY)) {
      resultDiv.innerHTML = '<span style="color: red;">æŠ•å½±åæ ‡æœ‰è¯¯å“¦ï¼</span>';
      return;
    }

    let coords = [projX, projY];
    let sourceProj;

    if (projectionType === 'wgs84') {
      resultDiv.innerHTML = '<span style="color: orange;">å·²ä¸º WGS84ï¼Œæ— éœ€è½¬æ¢ï¼</span>';
      return;
    } else if (projectionType === 'webMercator') {
      sourceProj = 'EPSG:3857';
      coords = ol.proj.toLonLat(coords); // Web Mercator è½¬ WGS84
    } else if (projectionType === 'gaussKruger' && band) {
      sourceProj = getGaussKrugerDef(parseInt(band));
      coords = proj4(sourceProj, 'EPSG:4326', coords); // é«˜æ–¯è½¬ WGS84
    } else {
      resultDiv.innerHTML = '<span style="color: red;">è¯·é€‰æ‹©å¸¦å·ï¼</span>';
      return;
    }

    resultDiv.innerHTML = `
      <strong>ç»çº¬åº¦ï¼ˆWGS84ï¼‰ï¼š</strong><br>
      ç»åº¦: ${coords[0].toFixed(6)}Â°, çº¬åº¦: ${coords[1].toFixed(6)}Â°
    `;
    document.getElementById('inputX').value = coords[0].toFixed(6);
    document.getElementById('inputY').value = coords[1].toFixed(6);
  }

  // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
  toggleBandInput();

    //å¯¼èˆªæ åˆ‡æ¢
    function switchTab(index) {
      const navItems = document.querySelectorAll('.nav-item');
      const contents = document.querySelectorAll('.content');
      navItems.forEach(item => item.classList.remove('active'));
      contents.forEach(content => content.classList.remove('active'));
      navItems[index].classList.add('active');
      contents[index].classList.add('active');
    }
 function setpro(){
  let seven=document.querySelector('#seven').value;
  let code=document.querySelector('#revise').value;
   
  if(code=4214){
    // å®šä¹‰åŒ—äº¬54ï¼ˆEPSG:4214ï¼‰å’Œè¥¿å®‰80ï¼ˆEPSG:4610ï¼‰çš„æŠ•å½±
    proj4.defs('EPSG:4214', `+proj=longlat +ellps=krass +towgs84=${seven} +no_defs`);
  }
  else{
    // è¥¿å®‰80 (EPSG:4610) åˆ° WGS84 (EPSG:4326) çš„åŒ—äº¬åœ°åŒºä¸ƒå‚æ•°
   proj4.defs('EPSG:4610', `+proj=longlat +ellps=IAG75 +towgs84=${seven} +no_defs`);
  }
  Swal.fire(
  'æˆåŠŸ!',
  'è®¾ç½®ä¸ƒå‚æ•°å·²å®Œæˆã€‚',
  'success'
);
 }
 function Export(){
  document.getElementById('longitude').value= document.getElementById("lon").value ;
  document.getElementById('latitude').value= document.getElementById("lat").value ;
  switchTab(1);
  Swal.fire(
  'æˆåŠŸ!',
  'å¯¼å…¥åæ ‡æˆåŠŸã€‚',
  'success'
);
 }

 let originalData = [];
  let convertedData = [];
  let errors = [];

   // è·å–é¡µé¢ä¸Šçš„æ–‡ä»¶è¾“å…¥å…ƒç´ 
   const fileInput = document.getElementById('csvInput');
        // ä¸ºæ–‡ä»¶è¾“å…¥å…ƒç´ çš„ change äº‹ä»¶æ·»åŠ ç›‘å¬å™¨ï¼Œå½“ç”¨æˆ·é€‰æ‹©æ–‡ä»¶æ—¶è§¦å‘
        fileInput.addEventListener('change', function () {
            // è·å–ç”¨æˆ·é€‰æ‹©çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼ˆfiles æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ŒåŒ…å«ç”¨æˆ·é€‰æ‹©çš„æ‰€æœ‰æ–‡ä»¶ï¼‰
            const file = this.files[0];
            // å¦‚æœç”¨æˆ·é€‰æ‹©äº†æ–‡ä»¶
            if (file) {
                // åˆ›å»ºä¸€ä¸ª FileReader å®ä¾‹ï¼Œç”¨äºè¯»å–æ–‡ä»¶
                const reader = new FileReader();
                // ä¸º FileReader çš„ load äº‹ä»¶æ·»åŠ ç›‘å¬å™¨ï¼Œå½“æ–‡ä»¶è¯»å–å®Œæˆæ—¶è§¦å‘
                reader.addEventListener('load', function () {
                    // è·å–è¯»å–åˆ°çš„æ–‡ä»¶å†…å®¹ï¼Œä»¥æ–‡æœ¬å½¢å¼å­˜å‚¨åœ¨ result å±æ€§ä¸­
                    const text = reader.result;
                    // ä½¿ç”¨é€—å·ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå°†æ–‡ä»¶å†…å®¹å­—ç¬¦ä¸²åˆ†å‰²æˆæ•°ç»„
                    const parts = text.split(',');
                    // å°†åˆ†å‰²åçš„æ•°ç»„æ‰“å°åˆ°æ§åˆ¶å°
                    console.log(parts);
                    originalData = text.split('\n').map(row => row.trim().split(','));
                    

const tbody = document.getElementById('coordsTableBody');
originalData = originalData.map(row => row.map(cell => parseFloat(cell)));
tbody.innerHTML = '';
originalData.forEach(row => {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td style="padding: 8px; border: 1px solid #e8ecef;">${ parseFloat(row[0]).toFixed(6)}</td>
    <td style="padding: 8px; border: 1px solid #e8ecef;">${ parseFloat(row[1]).toFixed(6)}</td>
    <td style="padding: 8px; border: 1px solid #e8ecef;">-</td>
    <td style="padding: 8px; border: 1px solid #e8ecef;">-</td>
    <td style="padding: 8px; border: 1px solid #e8ecef;">-</td>
  `;
  tbody.appendChild(tr);
});    
                });
                // ä»¥æ–‡æœ¬æ ¼å¼è¯»å–é€‰æ‹©çš„æ–‡ä»¶
                reader.readAsText(file);
            }
        });

  

  function convertBatch() {
    const sourceCRS = document.getElementById('sourceCRSS').value;
    const targetCRS = document.getElementById('targetCRSS').value;
    const tbody = document.getElementById('coordsTableBody');

    if (sourceCRS === targetCRS) {
      alert('åŸåæ ‡ç³»å’Œç›®æ ‡åæ ‡ç³»ç›¸åŒï¼Œæ— éœ€è½¬æ¢ï¼');
      return;
    }

    convertedData = [];
    errors = [];

    originalData.forEach(coords => {
      const converted = proj4(sourceCRS, targetCRS, coords);
      convertedData.push(converted);
      const error = ol.sphere.getDistance(coords, converted);
      errors.push(error);
    });

    tbody.innerHTML = '';
    originalData.forEach((row, index) => {
      const converted = convertedData[index];
      const error = errors[index];
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="padding: 8px; border: 1px solid #e8ecef;">${ parseFloat(row[0]).toFixed(6)}</td>
        <td style="padding: 8px; border: 1px solid #e8ecef;">${ parseFloat(row[0]).toFixed(6)}</td>
        <td style="padding: 8px; border: 1px solid #e8ecef;">${converted[0].toFixed(6)}</td>
        <td style="padding: 8px; border: 1px solid #e8ecef;">${converted[1].toFixed(6)}</td>
        <td style="padding: 8px; border: 1px solid #e8ecef;">${error.toFixed(2)}</td>
      `;
      tbody.appendChild(tr);
    });

    document.getElementById('exportBtn').disabled = false;
  }

  function exportCSV() {
    if (convertedData.length === 0) return;

    const csvContent = ['åŸå§‹ç»åº¦,åŸå§‹çº¬åº¦,è½¬æ¢åç»åº¦,è½¬æ¢åçº¬åº¦,è¯¯å·®(ç±³)']
      .concat(originalData.map((row, index) => `${ parseFloat(row[0])},${ parseFloat(row[0])},${convertedData[index][0]},${convertedData[index][1]},${errors[index]}`))
      .join('\n');

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'converted_geographic_coordinates.csv';
    link.click();
  }
  </script>
</body>
</html>
